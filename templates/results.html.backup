{% extends "layout.html" %}

{% block content %}
<!-- Geliştirilmiş Üst Bilgi Bölümü - Animasyonlu -->
<div class="row mb-4 fadeInUp">
    <div class="col-md-12">
        <div class="d-flex justify-content-between align-items-center flex-wrap">
            <div>
                <h2 class="mb-0 api-heading">
                    <i class="fas fa-clipboard-check me-2"></i>
                    Test Senaryosu Sonuçları
                </h2>
                <p class="text-muted mt-2">
                    <i class="fas fa-file-alt me-1"></i> {{ filename }} 
                    <span class="mx-2">•</span> 
                    <i class="fas fa-robot me-1"></i> {{ ai_model|upper }} tarafından üretildi
                    {% if docling_mode %}
                    <span class="badge {% if docling_mode == 'lite' %}bg-secondary{% else %}bg-success{% endif %} ms-2 rounded-pill">
                        <i class="fas fa-bolt me-1"></i> Docling {% if docling_mode == 'lite' %}Lite{% else %}Pro{% endif %}
                    </span>
                    {% endif %}
                </p>
            </div>
            <div class="d-flex gap-2 mt-2 mt-md-0">
                <a href="{{ url_for('index') }}" class="btn btn-outline-primary">
                    <i class="fas fa-arrow-left me-2"></i>
                    Yeni Doküman Yükle
                </a>
                <div class="dropdown">
                    <button class="btn btn-primary dropdown-toggle" type="button" id="shareDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-share-alt me-2"></i>
                        Paylaş
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="shareDropdown">
                        <li class="dropdown-header">Dışa Aktar</li>
                        <li>
                            <button class="dropdown-item" id="export-json">
                                <i class="fas fa-file-code me-2 text-info"></i>
                                JSON Olarak İndir
                            </button>
                        </li>
                        <li>
                            <button class="dropdown-item" id="export-text">
                                <i class="fas fa-file-alt me-2 text-secondary"></i>
                                Metin Olarak İndir
                            </button>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li class="dropdown-header">Hızlı Erişim</li>
                        <li>
                            <button class="dropdown-item" id="copy-link">
                                <i class="fas fa-link me-2 text-primary"></i>
                                Bağlantıyı Kopyala
                            </button>
                        </li>
                        <li>
                            <button class="dropdown-item" id="print-scenarios">
                                <i class="fas fa-print me-2 text-secondary"></i>
                                Yazdır
                            </button>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Editability notice alert - Geliştirilmiş Animasyonlu -->
<div class="alert luxury-alert alert-dismissible fade show mb-4 fadeInUp" style="animation-delay: 0.1s;" role="alert">
    <div class="d-flex">
        <div class="alert-icon pulse">
            <i class="fas fa-pencil-alt"></i>
        </div>
        <div class="ms-3">
            <h5 class="alert-heading">Düzenlenebilir İçerik</h5>
            <p class="mb-0">Test senaryolarını düzenlemek için metinlere tıklayabilirsiniz. Değişiklikleriniz anında kaydedilir ve otomatik olarak güncellenir.</p>
        </div>
    </div>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>

<!-- Test senaryoları verisi -->
<script>
    window.testScenariosData = {{ test_scenarios|tojson|safe }};
</script>

<!-- Ana İçerik Bölümü -->
<div class="row">
    <!-- Sol Taraftaki Kontrol Paneli - Animasyonlu -->
    <div class="col-md-3 mb-4">
        <div class="sticky-top" style="top: 20px;">
            <!-- Özet Kartı - Geliştirilmiş Tasarım -->
            <div class="card luxury-card mb-4 fadeInUp" style="animation-delay: 0.2s;">
                <div class="card-header d-flex align-items-center">
                    <i class="fas fa-chart-pie me-2"></i>
                    <h5 class="mb-0">Özet Bilgiler</h5>
                </div>
                <div class="card-body p-0">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span><i class="fas fa-cube me-2 text-primary"></i>Senaryolar</span>
                            <span class="badge rounded-pill bg-primary">
                                {{ scenario_set.total_scenarios if scenario_set else test_scenarios.scenarios|length }}
                            </span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span><i class="fas fa-vial me-2 text-success"></i>Test Durumları</span>
                            <span class="badge rounded-pill bg-success">
                                {% if scenario_set %}
                                    {{ scenario_set.total_test_cases }}
                                {% else %}
                                    {% set test_count = 0 %}
                                    {% for scenario in test_scenarios.scenarios %}
                                        {% set test_count = test_count + scenario.test_cases|length %}
                                    {% endfor %}
                                    {{ test_count }}
                                {% endif %}
                            </span>
                        </li>
                        {% if analytics %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span><i class="fas fa-tachometer-alt me-2 text-info"></i>Kapsama Skoru</span>
                            <div class="progress" style="width: 60%;">
                                <div class="progress-bar bg-info" role="progressbar" 
                                    style="width: {{ analytics.coverage_score }}%;" 
                                    aria-valuenow="{{ analytics.coverage_score }}" 
                                    aria-valuemin="0" aria-valuemax="100">
                                    {{ analytics.coverage_score|round(1) }}%
                                </div>
                            </div>
                        </li>
                        {% endif %}
                    </ul>
                </div>
                {% if analytics %}
                <div class="card-footer text-center">
                    <a href="{{ url_for('analytics') }}" class="btn btn-sm btn-outline-primary w-100">
                        <i class="fas fa-chart-bar me-2"></i>
                        Detaylı Analitik
                    </a>
                </div>
                {% endif %}
            </div>
            
            <!-- AI Bilgileri Kartı - Geliştirilmiş Tasarım -->
            <div class="card luxury-card mb-4 fadeInUp" style="animation-delay: 0.3s;">
                <div class="card-header d-flex align-items-center">
                    <i class="fas fa-robot me-2"></i>
                    <h5 class="mb-0">AI Modeli</h5>
                </div>
                <div class="card-body">
                    <div class="d-flex align-items-center justify-content-center mb-3">
                        <div class="ai-model-badge glow">
                            <i class="fas fa-brain"></i>
                            <span>{{ ai_model.upper() }}</span>
                        </div>
                    </div>
                    <div class="small text-center">
                        <p class="mb-1 text-muted">Bu test senaryoları, Doctest yapay zeka modelleri kullanılarak oluşturulmuştur.</p>
                    {% if parser_used %}
                        <div class="mt-2">
                            <span class="badge bg-info">
                                <i class="fas fa-file-code me-1"></i>
                                {% if parser_used == "neuradoc" %}
                                    NeuraDoc
                                {% elif parser_used == 'docling' %}
                                    Docling
                                {% elif parser_used == 'llama_parse' %}
                                    LlamaParse
                                {% elif parser_used == 'auto_detect' %}
                                    Otomatik
                                {% else %}
                                    {{ parser_used|capitalize }}
                                {% endif %}
                                Parser
                            </span>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Doküman Bilgileri - Geliştirilmiş Tasarım -->
            {% if test_scenarios is defined and test_scenarios and (test_scenarios.document_type or test_scenarios.page_count or test_scenarios.contains_images or test_scenarios.contains_tables) %}
            <div class="card luxury-card mb-4 fadeInUp" style="animation-delay: 0.4s;">
                <div class="card-header d-flex align-items-center">
                    <i class="fas fa-file-alt me-2"></i>
                    <h5 class="mb-0">Doküman Bilgileri</h5>
                </div>
                <div class="card-body p-0">
                    <ul class="list-group list-group-flush">
                        {% if test_scenarios.document_type %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span><i class="fas fa-file-pdf me-2 text-danger"></i>Doküman Tipi</span>
                            <span class="badge bg-secondary rounded-pill">{{ test_scenarios.document_type }}</span>
                        </li>
                        {% endif %}
                        
                        {% if test_scenarios.page_count %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span><i class="fas fa-copy me-2 text-primary"></i>Sayfa Sayısı</span>
                            <span class="badge bg-secondary rounded-pill">{{ test_scenarios.page_count }}</span>
                        </li>
                        {% endif %}
                        
                        {% if test_scenarios.contains_images %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span><i class="fas fa-images me-2 text-info"></i>Resim Sayısı</span>
                            <span class="badge bg-secondary rounded-pill">{{ test_scenarios.image_count }}</span>
                        </li>
                        {% endif %}
                        
                        {% if test_scenarios.contains_tables %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span><i class="fas fa-table me-2 text-success"></i>Tablo Sayısı</span>
                            <span class="badge bg-secondary rounded-pill">{{ test_scenarios.table_count }}</span>
                        </li>
                        {% endif %}
                        
                        {% if test_scenarios.document_complexity %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span><i class="fas fa-project-diagram me-2 text-warning"></i>Karmaşıklık</span>
                            <span class="badge bg-secondary rounded-pill">{{ test_scenarios.document_complexity }}</span>
                        </li>
                        {% endif %}
                    </ul>
                </div>
            </div>
            {% endif %}
            
            <!-- Hızlı İşlemler Butonu -->
            <div class="d-grid gap-2 fadeInUp" style="animation-delay: 0.5s;">
                <button class="btn btn-outline-primary" type="button" data-bs-toggle="modal" data-bs-target="#shareModal">
                    <i class="fas fa-share-alt me-2"></i>Hızlı İşlemler
                </button>
            </div>
        </div>
    </div>
    
    <!-- Sağ Taraftaki Ana İçerik - Animasyonlu -->
    <div class="col-md-9">
        <!-- Özet Bilgi Kartı - Geliştirilmiş Tasarım -->
        <div class="card luxury-card mb-4 fadeInUp" style="animation-delay: 0.2s;">
            <div class="card-header d-flex justify-content-between align-items-center">
                <div>
                    <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Doküman Özeti</h5>
                </div>
                <div>
                    <button class="btn btn-sm btn-outline-secondary" id="copyAllBtn" title="Tüm özeti kopyala">
                        <i class="fas fa-copy"></i>
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="summary-content editable" data-field="summary" data-document-id="{{ scenario_set.id if scenario_set else '' }}">
                    {{ test_scenarios.summary }}
                </div>
                
                <!-- Etiketler - Geliştirilmiş Tasarım -->
                {% if test_scenarios.tags is defined and test_scenarios.tags %}
                <div class="mt-4">
                    <h6 class="mb-2"><i class="fas fa-tags me-2 text-info"></i>Etiketler</h6>
                    <div class="d-flex flex-wrap gap-2">
                        {% for tag in test_scenarios.tags %}
                        <span class="badge rounded-pill bg-info">
                            <i class="fas fa-tag me-1"></i>{{ tag }}
                        </span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Seçenek sekmeleri - Geliştirilmiş Tasarım -->
        <ul class="nav nav-tabs mb-4 fadeInUp" id="scenarioTabs" role="tablist" style="animation-delay: 0.3s;">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="scenarios-tab" data-bs-toggle="tab" data-bs-target="#scenarios-panel" type="button" role="tab" aria-controls="scenarios-panel" aria-selected="true">
                    <i class="fas fa-list-ul me-2"></i>Test Senaryoları
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="playground-tab" data-bs-toggle="tab" data-bs-target="#playground-panel" type="button" role="tab" aria-controls="playground-panel" aria-selected="false">
                    <i class="fas fa-code me-2"></i>Playground
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="automation-tab" data-bs-toggle="tab" data-bs-target="#automation-panel" type="button" role="tab" aria-controls="automation-panel" aria-selected="false">
                    <i class="fas fa-robot me-2"></i>Test Otomasyonu
                </button>
            </li>
            <li class="nav-item ms-auto" role="presentation">
                <button class="nav-link" id="document-tab" data-bs-toggle="modal" data-bs-target="#documentContentModal" type="button">
                    <i class="fas fa-file-alt me-2"></i>Orijinal Doküman
                </button>
            </li>
        </ul>

        <!-- Tab içerikleri -->
        <div class="tab-content" id="scenarioTabContent">
            <!-- Test Senaryoları Paneli - Geliştirilmiş Tasarım -->
            <div class="tab-pane fade show active" id="scenarios-panel" role="tabpanel" aria-labelledby="scenarios-tab">
                <div class="card luxury-card mb-4 fadeInUp" style="animation-delay: 0.4s;">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-tasks me-2"></i>Test Senaryoları</h5>
                        <div class="scenario-controls">
                            <div class="d-flex gap-2">
                                <div class="btn-group btn-group-sm" role="group">
                                    <button type="button" class="btn btn-outline-primary" id="expandAllBtn" title="Tüm senaryoları genişlet">
                                        <i class="fas fa-expand-alt me-1"></i> Genişlet
                                    </button>
                                    <button type="button" class="btn btn-outline-primary" id="collapseAllBtn" title="Tüm senaryoları daralt">
                                        <i class="fas fa-compress-alt me-1"></i> Daralt
                                    </button>
                                </div>
                                <button type="button" class="btn btn-sm btn-outline-secondary" id="copyAllScenarios" title="Tüm senaryoları kopyala">
                                    <i class="fas fa-copy me-1"></i>
                                </button>
                            </div>
                        </div>
                    </div>
            <div class="card-body p-0">
                {% if test_scenarios.scenarios %}
                <div class="accordion scenario-accordion" id="scenariosAccordion">
                    {% for scenario in test_scenarios.scenarios %}
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="heading{{ loop.index }}">
                            <button class="accordion-button {% if not loop.first %}collapsed{% endif %}" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ loop.index }}" aria-expanded="{{ 'true' if loop.first else 'false' }}" aria-controls="collapse{{ loop.index }}">
                                <div class="d-flex align-items-center w-100">
                                    <span class="scenario-number me-3">{{ loop.index }}</span>
                                    <span class="scenario-title">{{ scenario.title }}</span>
                                    
                                    <!-- Etiketler -->
                                    <div class="ms-auto me-3 d-none d-md-block">
                                        {% if scenario.may_involve_visual_elements is defined and scenario.may_involve_visual_elements %}
                                        <span class="badge bg-info me-1">
                                            <i class="fas fa-images me-1"></i> Görsel İçerik
                                        </span>
                                        {% endif %}
                                        {% if scenario.test_cases|length > 0 %}
                                        <span class="badge bg-success">
                                            <i class="fas fa-vial me-1"></i> {{ scenario.test_cases|length }} Test
                                        </span>
                                        {% endif %}
                                    </div>
                                </div>
                            </button>
                        </h2>
                        <div id="collapse{{ loop.index }}" class="accordion-collapse collapse {% if loop.first %}show{% endif %}" aria-labelledby="heading{{ loop.index }}" data-bs-parent="#scenariosAccordion">
                            <div class="accordion-body">
                                <!-- Mobil görünümde etiketler -->
                                <div class="d-block d-md-none mb-3">
                                    {% if scenario.may_involve_visual_elements is defined and scenario.may_involve_visual_elements %}
                                    <span class="badge bg-info me-1">
                                        <i class="fas fa-images me-1"></i> Görsel İçerik
                                    </span>
                                    {% endif %}
                                    {% if scenario.test_cases|length > 0 %}
                                    <span class="badge bg-success">
                                        <i class="fas fa-vial me-1"></i> {{ scenario.test_cases|length }} Test
                                    </span>
                                    {% endif %}
                                </div>
                                
                                <!-- Senaryo açıklaması -->
                                <div class="scenario-content mb-4">
                                    <h5 class="scenario-subtitle">
                                        <i class="fas fa-info-circle me-2"></i>Açıklama
                                    </h5>
                                    <div class="scenario-description editable" data-field="description" data-scenario-index="{{ loop.index0 }}" data-document-id="{{ scenario_set.id if scenario_set else '' }}">
                                        {{ scenario.description }}
                                    </div>
                                </div>
                                
                                <!-- Görsel öğeler uyarısı -->
                                {% if scenario.may_involve_visual_elements is defined and scenario.may_involve_visual_elements %}
                                <div class="alert luxury-alert luxury-alert-info mb-4">
                                    <div class="d-flex">
                                        <div class="alert-icon">
                                            <i class="fas fa-tv"></i>
                                        </div>
                                        <div class="ms-3">
                                            <h6 class="alert-heading">Görsel Öğeler İçerir</h6>
                                            <p class="mb-0">Bu senaryo dokümanınızdaki görsel öğelere (resimler, tablolar veya diyagramlar) dayalı testler içerebilir.</p>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                                
                                <!-- Test durumları -->
                                <div class="test-cases-section">
                                    <h5 class="scenario-subtitle mb-3">
                                        <i class="fas fa-vial me-2"></i>Test Durumları
                                    </h5>
                                    
                                    <div class="test-cases-container">
                                        {% set scenario_index = loop.index0 %}
                                        {% for test_case in scenario.test_cases %}
                                        <div class="test-case-card">
                                            <div class="test-case-header">
                                                <h6 class="test-case-title">
                                                    <span class="test-case-number">{{ loop.index }}</span>
                                                    {{ test_case.title }}
                                                </h6>
                                                <div class="test-case-badges">
                                                    {% if test_case.involves_rich_content is defined and test_case.involves_rich_content %}
                                                    <span class="badge bg-info">
                                                        <i class="fas fa-images me-1"></i> Zengin İçerik
                                                    </span>
                                                    {% endif %}
                                                    
                                                    {% if test_case.priority is defined %}
                                                    <span class="badge bg-{{ 'danger' if test_case.priority == 'Yüksek' else 'warning' if test_case.priority == 'Orta' else 'secondary' }}">
                                                        {{ test_case.priority }}
                                                    </span>
                                                    {% endif %}
                                                    
                                                    {% if test_case.type is defined %}
                                                    <span class="badge bg-primary">
                                                        {{ test_case.type }}
                                                    </span>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            
                                            <div class="test-case-content">
                                                <!-- Test adımları -->
                                                <div class="test-step-section">
                                                    <div class="test-step-label">Adımlar:</div>
                                                    <div class="test-step-content editable" data-field="steps" data-scenario-index="{{ scenario_index }}" data-testcase-index="{{ loop.index0 }}" data-document-id="{{ scenario_set.id if scenario_set else '' }}">
                                                        {{ test_case.steps }}
                                                    </div>
                                                </div>
                                                
                                                <!-- Beklenen sonuçlar -->
                                                <div class="test-step-section">
                                                    <div class="test-step-label">Beklenen Sonuçlar:</div>
                                                    <div class="test-step-content editable" data-field="expected_results" data-scenario-index="{{ scenario_index }}" data-testcase-index="{{ loop.index0 }}" data-document-id="{{ scenario_set.id if scenario_set else '' }}">
                                                        {{ test_case.expected_results }}
                                                    </div>
                                                </div>
                                                
                                                <!-- Önkoşullar (varsa) -->
                                                {% if test_case.prerequisites is defined %}
                                                <div class="test-step-section">
                                                    <div class="test-step-label">Önkoşullar:</div>
                                                    <div class="test-step-content editable" data-field="prerequisites" data-scenario-index="{{ scenario_index }}" data-testcase-index="{{ loop.index0 }}" data-document-id="{{ scenario_set.id if scenario_set else '' }}">
                                                        {{ test_case.prerequisites }}
                                                    </div>
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="alert luxury-alert luxury-alert-warning m-3">
                    <div class="d-flex">
                        <div class="alert-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="ms-3">
                            <h5 class="alert-heading">Senaryo Bulunamadı</h5>
                            <p class="mb-0">Hiçbir test senaryosu oluşturulamadı. Lütfen farklı bir doküman veya AI modeli ile tekrar deneyin.</p>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Playground Paneli -->
    <div class="tab-pane fade" id="playground-panel" role="tabpanel" aria-labelledby="playground-tab">
        <div class="card luxury-card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-code me-2"></i>Test Playground</h5>
            </div>
            <div class="card-body">
                <div class="alert luxury-alert alert-info mb-4">
                    <div class="d-flex">
                        <div class="alert-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="ms-3">
                            <h6 class="alert-heading">Test Playground Nedir?</h6>
                            <p class="mb-0">Bu alan, test senaryolarını canlı olarak düzenleyip çalıştırabileceğiniz interaktif bir ortam sunar. Senaryolarınızı modifiye edebilir ve gerçek zamanlı olarak test edebilirsiniz.</p>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label for="scenarioSelect" class="form-label">Test Senaryosu Seçin</label>
                    <select class="form-select" id="scenarioSelect">
                        <option value="" selected>Bir senaryo seçin...</option>
                        {% for scenario in test_scenarios.scenarios %}
                        <option value="{{ loop.index0 }}">{{ scenario.title }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="playground-editor-container d-none" id="playgroundContainer">
                    <div class="row mb-3">
                        <div class="col-md-6 mb-3 mb-md-0">
                            <div class="playground-section">
                                <h6 class="mb-2">Senaryo Adı</h6>
                                <input type="text" class="form-control" id="playgroundTitle">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="playground-section">
                                <h6 class="mb-2">Öncelik</h6>
                                <select class="form-select" id="playgroundPriority">
                                    <option value="Yüksek">Yüksek</option>
                                    <option value="Orta">Orta</option>
                                    <option value="Düşük">Düşük</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="playground-section mb-3">
                        <h6 class="mb-2">Açıklama</h6>
                        <textarea class="form-control" id="playgroundDescription" rows="3"></textarea>
                    </div>
                    
                    <div class="playground-section mb-3">
                        <h6 class="mb-2">Test Adımları</h6>
                        <div id="stepsEditor" class="code-editor-area mb-2">
                            <pre class="line-numbers"><code class="language-markdown" id="playgroundSteps"></code></pre>
                        </div>
                    </div>
                    
                    <div class="playground-section mb-4">
                        <h6 class="mb-2">Beklenen Sonuçlar</h6>
                        <div id="resultsEditor" class="code-editor-area mb-2">
                            <pre class="line-numbers"><code class="language-markdown" id="playgroundExpectedResults"></code></pre>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-end gap-2">
                        <button class="btn btn-outline-secondary" id="resetPlaygroundBtn">
                            <i class="fas fa-undo me-2"></i>Sıfırla
                        </button>
                        <button class="btn btn-primary" id="savePlaygroundBtn">
                            <i class="fas fa-save me-2"></i>Kaydet
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Test Otomasyonu Paneli -->
    <div class="tab-pane fade" id="automation-panel" role="tabpanel" aria-labelledby="automation-tab">
        <div class="card luxury-card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-robot me-2"></i>Test Otomasyonu</h5>
            </div>
            <div class="card-body">
                <div class="alert luxury-alert alert-info mb-4">
                    <div class="d-flex">
                        <div class="alert-icon">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="ms-3">
                            <h6 class="alert-heading">Otomatik Test Dönüşümü</h6>
                            <p class="mb-0">Bu araç, manuel test senaryolarınızı çeşitli test otomasyon formatlarına dönüştürmenize olanak tanır. İstediğiniz test senaryosunu ve hedef otomasyon formatını seçin.</p>
                        </div>
                    </div>
                </div>
                
                <div class="row mb-4">
                    <div class="col-md-6 mb-3 mb-md-0">
                        <label for="automationScenarioSelect" class="form-label">Test Senaryosu</label>
                        <select class="form-select" id="automationScenarioSelect">
                            <option value="" selected>Dönüştürülecek senaryoyu seçin...</option>
                            {% for scenario in test_scenarios.scenarios %}
                            <option value="{{ loop.index0 }}">{{ scenario.title }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="automationFormatSelect" class="form-label">Otomasyon Formatı</label>
                        <select class="form-select" id="automationFormatSelect">
                            <option value="selenium-java">Selenium (Java)</option>
                            <option value="selenium-python">Selenium (Python)</option>
                            <option value="cypress">Cypress (JavaScript)</option>
                            <option value="playwright">Playwright (TypeScript)</option>
                            <option value="appium">Appium (Mobile)</option>
                            <option value="restassured">REST Assured (API Testing)</option>
                            <option value="cucumber">Cucumber (Gherkin)</option>
                        </select>
                    </div>
                </div>
                
                <div class="d-grid mb-4">
                    <button class="btn btn-primary" id="generateAutomationBtn">
                        <i class="fas fa-magic me-2"></i>Otomasyona Dönüştür
                    </button>
                </div>
                
                <div id="automationResult" class="d-none">
                    <div class="automation-code-header d-flex justify-content-between align-items-center mb-2">
                        <h6 class="mb-0">Otomasyon Kodu</h6>
                        <button class="btn btn-sm btn-outline-primary" id="copyAutomationBtn">
                            <i class="fas fa-copy me-1"></i>Kopyala
                        </button>
                    </div>
                    <div class="automation-code-container">
                        <pre class="line-numbers"><code class="language-java" id="automationCode"></code></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
        
        <!-- Doküman İçeriği Kartı (Katlanabilir) -->
        <div class="card luxury-card">
            <div class="card-header" id="documentHeaderToggle" role="button" data-bs-toggle="collapse" data-bs-target="#documentContentCollapse" aria-expanded="false" aria-controls="documentContentCollapse">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-file-alt me-2"></i>Orijinal Doküman İçeriği</h5>
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
            <div id="documentContentCollapse" class="collapse">
                <div class="card-body p-0">
                    <div class="document-text">
                        <pre class="document-content">{{ document_text }}</pre>
                    <h5 class="mt-4 mb-3"><i class="fas fa-info-circle me-2"></i>Doküman İçeriği Tamamen İşlendi ve Gösteriliyor</h5>
                        
                        {% if test_scenarios.extracted_images or test_scenarios.image_count > 0 %}
                        <h5 class="mt-4 mb-3"><i class="fas fa-images me-2"></i>Belgeden Çıkarılan Görseller ({{ test_scenarios.image_count }} adet):</h5>
                        <div class="row">
                            {% for image in test_scenarios.extracted_images %}
                            <div class="col-md-6 col-lg-4 mb-3">
                                <div class="card">
                                    <img src="data:image/{{ image.format }};base64,{{ image.content }}" 
                                         class="card-img-top img-fluid" 
                                         alt="{{ image.description or 'Doküman Görseli' }}">
                                    <div class="card-body p-2">
                                        <p class="card-text small">
                                            {% if image.description %}{{ image.description }}{% else %}Doküman Görseli {% endif %}
                                            {% if image.analysis %}<br><small class="text-muted">{{ image.analysis }}</small>{% endif %}
                                        </p>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}
                        
                        {% if test_scenarios.extracted_tables or test_scenarios.table_count > 0 %}
                        <h5 class="mt-4 mb-3"><i class="fas fa-table me-2"></i>Belgeden Çıkarılan Tablolar ({{ test_scenarios.table_count }} adet):</h5>
                        <div class="row">
                            {% for table in test_scenarios.extracted_tables %}
                            <div class="col-12 mb-3">
                                <div class="card">
                                    <div class="card-header">
                                        <strong>{% if table.caption %}{{ table.caption }}{% else %}Tablo {{ loop.index }}{% endif %}</strong>
                                    </div>
                                    <div class="card-body p-2">
                                        <div class="table-responsive">
                                            <table class="table table-sm table-bordered">
                                                {% if table.headers %}
                                                <thead>
                                                    <tr>
                                                        {% for header in table.headers %}
                                                        <th>{{ header }}</th>
                                                        {% endfor %}
                                                    </tr>
                                                </thead>
                                                {% endif %}
                                                <tbody>
                                                    {% for row in table.content %}
                                                    <tr>
                                                        {% for cell in row %}
                                                        <td>{{ cell }}</td>
                                                        {% endfor %}
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Özel JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Genişlet/Daralt butonları
    const expandAllBtn = document.getElementById('expandAllBtn');
    const collapseAllBtn = document.getElementById('collapseAllBtn');
    
    if (expandAllBtn) {
        expandAllBtn.addEventListener('click', function() {
            document.querySelectorAll('.accordion-collapse').forEach(collapse => {
                collapse.classList.add('show');
                const button = document.querySelector(`[data-bs-target="#${collapse.id}"]`);
                if (button) button.classList.remove('collapsed');
                button.setAttribute('aria-expanded', 'true');
            });
        });
    }
    
    if (collapseAllBtn) {
        collapseAllBtn.addEventListener('click', function() {
            document.querySelectorAll('.accordion-collapse').forEach(collapse => {
                if (collapse.classList.contains('show')) {
                    collapse.classList.remove('show');
                    const button = document.querySelector(`[data-bs-target="#${collapse.id}"]`);
                    if (button) button.classList.add('collapsed');
                    button.setAttribute('aria-expanded', 'false');
                }
            });
        });
    }
    
    // Bağlantıyı kopyala butonu
    const copyLinkBtn = document.getElementById('copy-link');
    if (copyLinkBtn) {
        copyLinkBtn.addEventListener('click', function() {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                // Başarı geri bildirimi
                const originalText = copyLinkBtn.innerHTML;
                copyLinkBtn.innerHTML = '<i class="fas fa-check me-2"></i>Kopyalandı';
                setTimeout(() => {
                    copyLinkBtn.innerHTML = originalText;
                }, 2000);
            });
        });
    }
    
    // Doküman başlığına tıklanıldığında icon değişimi
    const documentHeaderToggle = document.getElementById('documentHeaderToggle');
    if (documentHeaderToggle) {
        documentHeaderToggle.addEventListener('click', function() {
            const icon = this.querySelector('.fas');
            if (icon.classList.contains('fa-chevron-down')) {
                icon.classList.replace('fa-chevron-down', 'fa-chevron-up');
            } else {
                icon.classList.replace('fa-chevron-up', 'fa-chevron-down');
            }
        });
    }
});
</script>

<!-- Özel Stil -->
<style>
/* Playground styles */
.code-editor-area {
    background-color: rgba(26, 26, 46, 0.4);
    border-radius: 6px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    min-height: 150px;
    overflow: hidden;
}

.code-editor-area pre {
    margin: 0;
    min-height: inherit;
    background-color: transparent !important;
    border: none !important;
    padding: 16px;
}

.code-editor-area code {
    min-height: inherit;
    font-family: "Roboto Mono", monospace;
    white-space: pre-wrap;
}

.playground-section h6 {
    color: var(--api-silver);
    font-weight: 600;
}

.automation-code-container {
    background-color: rgba(26, 26, 46, 0.4);
    border-radius: 6px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    overflow: hidden;
    max-height: 600px;
    overflow-y: auto;
}

.automation-code-container pre {
    margin: 0;
    background-color: transparent !important;
    border: none !important;
    padding: 16px;
}

.automation-code-header {
    padding: 8px 0;
}

/* Senaryo listesi için özel stiller */
.scenario-accordion .accordion-item {
    border-radius: 8px;
    overflow: hidden;
    margin-bottom: 12px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    background-color: rgba(26, 26, 46, 0.3);
}

.scenario-accordion .accordion-button {
    padding: 16px;
    background: linear-gradient(90deg, rgba(0, 51, 102, 0.8) 0%, rgba(0, 86, 179, 0.6) 100%);
}

.scenario-accordion .accordion-button:not(.collapsed) {
    background: linear-gradient(90deg, var(--api-primary) 0%, var(--api-secondary) 100%);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.scenario-number {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background-color: rgba(255, 255, 255, 0.2);
    color: white;
    font-weight: bold;
    font-size: 14px;
}

.scenario-title {
    font-weight: 600;
    font-size: 16px;
}

.scenario-subtitle {
    font-size: 18px;
    margin-bottom: 12px;
    color: var(--api-gold);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    padding-bottom: 8px;
}

/* Test durumları için özel stiller */
.test-cases-container {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.test-case-card {
    background-color: rgba(26, 26, 46, 0.4);
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    overflow: hidden;
}

.test-case-header {
    background: linear-gradient(90deg, rgba(18, 110, 130, 0.5) 0%, rgba(10, 35, 66, 0.5) 100%);
    padding: 12px 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.test-case-title {
    margin: 0;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
}

.test-case-number {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background-color: rgba(255, 255, 255, 0.2);
    font-size: 12px;
}

.test-case-badges {
    display: flex;
    gap: 6px;
}

.test-case-content {
    padding: 16px;
}

.test-step-section {
    margin-bottom: 12px;
}

.test-step-section:last-child {
    margin-bottom: 0;
}

.test-step-label {
    font-weight: 600;
    margin-bottom: 4px;
    color: var(--api-silver);
}

.test-step-content {
    background-color: rgba(255, 255, 255, 0.05);
    padding: 8px 12px;
    border-radius: 4px;
    font-size: 14px;
}

/* AI Modeli rozeti */
.ai-model-badge {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    background: linear-gradient(135deg, var(--api-primary) 0%, var(--api-secondary) 100%);
    color: white;
    padding: 10px 20px;
    border-radius: 50px;
    font-weight: 600;
    box-shadow: 0 0 15px rgba(18, 110, 130, 0.5);
    border: 1px solid var(--api-gold);
}

.ai-model-badge i {
    font-size: 20px;
    color: var(--api-gold);
}

/* Özel uyarı kutusu */
.luxury-alert {
    border: none;
    border-radius: 8px;
    padding: 16px;
    background-color: rgba(26, 26, 46, 0.95);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.luxury-alert .alert-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background-color: rgba(255, 255, 255, 0.1);
    font-size: 20px;
}

.luxury-alert-info .alert-icon {
    color: var(--api-secondary);
}

.luxury-alert-warning .alert-icon {
    color: var(--api-warning);
}

.luxury-alert .alert-heading {
    font-weight: 600;
    margin-bottom: 4px;
}

/* Doküman içeriği */
.document-text {
    max-height: 600px;
    overflow-y: auto;
}

/* Düzenlenebilir içerik */
.editable {
    position: relative;
    transition: all 0.2s;
    border-radius: 4px;
    padding: 8px;
}

.editable:hover {
    background-color: rgba(255, 255, 255, 0.05);
}

.editable:hover::after {
    content: "✏️";
    position: absolute;
    right: 8px;
    top: 8px;
    font-size: 14px;
    opacity: 0.7;
}

.summary-content {
    font-size: 16px;
    line-height: 1.6;
}

/* Mobil dostu stil düzenlemeleri */
@media (max-width: 767px) {
    .scenario-number {
        width: 24px;
        height: 24px;
        font-size: 12px;
    }
    
    .scenario-title {
        font-size: 14px;
    }
    
    .test-case-header {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .test-case-badges {
        margin-top: 8px;
    }
}
</style>

<!-- Modal: Dosya İçeriği - Geliştirilmiş -->
<div class="modal fade" id="documentContentModal" tabindex="-1" aria-labelledby="documentContentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header d-flex justify-content-between align-items-center">
                <h5 class="modal-title" id="documentContentModalLabel">
                    <i class="fas fa-file-alt me-2 text-primary"></i>Doküman İçeriği
                </h5>
                <div class="d-flex gap-2">
                    <button type="button" class="btn btn-sm btn-outline-secondary" id="copyDocumentContent">
                        <i class="fas fa-copy me-1"></i> Kopyala
                    </button>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
            </div>
            <div class="modal-body">
                <div class="document-text">
                    {% if document_text %}
                    <pre class="document-content">{{ document_text }}</pre>
                    {% if test_scenarios.extracted_images and test_scenarios.image_count > 0 %}
                    <h5 class="mt-4 mb-3"><i class="fas fa-images me-2"></i>Belgeden Çıkarılan Görseller ({{ test_scenarios.image_count }} adet):</h5>
                    <div class="row">
                        {% for image in test_scenarios.extracted_images %}
                        <div class="col-md-6 col-lg-4 mb-3">
                            <div class="card">
                                <img src="data:image/{{ image.format }};base64,{{ image.content }}" 
                                     class="card-img-top img-fluid" 
                                     alt="{{ image.description or 'Doküman Görseli' }}">
                                <div class="card-body p-2">
                                    <p class="card-text small">
                                        {% if image.description %}{{ image.description }}{% else %}Doküman Görseli {% endif %}
                                        {% if image.analysis %}<br><small class="text-muted">{{ image.analysis }}</small>{% endif %}
                                    </p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}

                    {% if test_scenarios.extracted_tables and test_scenarios.table_count > 0 %}
                    <h5 class="mt-4 mb-3"><i class="fas fa-table me-2"></i>Belgeden Çıkarılan Tablolar ({{ test_scenarios.table_count }} adet):</h5>
                    <div class="row">
                        {% for table in test_scenarios.extracted_tables %}
                        <div class="col-12 mb-3">
                            <div class="card">
                                <div class="card-header">
                                    <strong>{% if table.caption %}{{ table.caption }}{% else %}Tablo {{ loop.index }}{% endif %}</strong>
                                </div>
                                <div class="card-body p-2">
                                    <div class="table-responsive">
                                        <table class="table table-sm table-bordered">
                                            {% if table.headers %}
                                            <thead>
                                                <tr>
                                                    {% for header in table.headers %}
                                                    <th>{{ header }}</th>
                                                    {% endfor %}
                                                </tr>
                                            </thead>
                                            {% endif %}
                                            <tbody>
                                                {% for row in table.content %}
                                                <tr>
                                                    {% for cell in row %}
                                                    <td>{{ cell }}</td>
                                                    {% endfor %}
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                    <h5 class="mt-4 mb-3"><i class="fas fa-info-circle me-2"></i>Doküman İçeriği Tamamen İşlendi ve Gösteriliyor</h5>
                    {% else %}
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Orijinal doküman içeriği bulunamadı. Doküman metni kayıtlı olmayabilir veya istemci tarafında beklenmeyen bir hata oluşmuş olabilir.
                    </div>
                    {% endif %}
                </div>
            </div>
            <div class="modal-footer">
                <span class="small text-muted">
                    <i class="fas fa-info-circle me-1"></i> Bu metin, test senaryolarının oluşturulduğu orijinal içeriği gösterir.
                </span>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Hızlı İşlemler -->
<div class="modal fade" id="shareModal" tabindex="-1" aria-labelledby="shareModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="shareModalLabel">
                    <i class="fas fa-share-alt me-2 text-primary"></i>Hızlı İşlemler
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="d-grid gap-3">
                    <div class="card luxury-card">
                        <div class="card-body p-3">
                            <div class="d-flex align-items-center">
                                <div class="me-3">
                                    <i class="fas fa-file-export fa-2x text-info"></i>
                                </div>
                                <div>
                                    <h6 class="mb-1">Test Senaryolarını Dışa Aktar</h6>
                                    <p class="mb-2 small text-muted">Farklı formatlarda indirin veya paylaşın</p>
                                    <div class="btn-group btn-group-sm">
                                        <button class="btn btn-outline-primary share-button" id="modal-export-json">
                                            <i class="fas fa-file-code me-1"></i> JSON
                                        </button>
                                        <button class="btn btn-outline-primary share-button" id="modal-export-text">
                                            <i class="fas fa-file-alt me-1"></i> Metin
                                        </button>
                                        <button class="btn btn-outline-primary share-button" id="modal-export-print">
                                            <i class="fas fa-print me-1"></i> Yazdır
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card luxury-card">
                        <div class="card-body p-3">
                            <div class="d-flex align-items-center">
                                <div class="me-3">
                                    <i class="fas fa-link fa-2x text-primary"></i>
                                </div>
                                <div>
                                    <h6 class="mb-1">Bağlantı Paylaş</h6>
                                    <p class="mb-2 small text-muted">Bu senaryoları bağlantı ile paylaşın</p>
                                    <div class="input-group input-group-sm">
                                        <input type="text" class="form-control" id="shareLink" value="{{ request.url }}" readonly>
                                        <button class="btn btn-outline-primary" type="button" id="modal-copy-link">
                                            <i class="fas fa-copy me-1"></i> Kopyala
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card luxury-card">
                        <div class="card-body p-3">
                            <div class="d-flex align-items-center">
                                <div class="me-3">
                                    <i class="fas fa-file-alt fa-2x text-success"></i>
                                </div>
                                <div>
                                    <h6 class="mb-1">Doküman İçeriği</h6>
                                    <p class="mb-2 small text-muted">Orijinal doküman içeriğini görüntüleyin</p>
                                    <button class="btn btn-sm btn-outline-primary w-100" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#documentContentModal">
                                        <i class="fas fa-eye me-1"></i> İçeriği Görüntüle
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Toast Bildirimleri -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="copyToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <i class="fas fa-check-circle text-success me-2"></i>
            <strong class="me-auto">Başarılı</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body">
            İçerik panoya kopyalandı!
        </div>
    </div>
</div>

{% endblock %}
{% if (test_scenarios is defined and test_scenarios and test_scenarios.extracted_images is defined and test_scenarios.image_count is defined and test_scenarios.image_count > 0) or (document_structure is defined and document_structure.extracted_images is defined) %}
<div class="card luxury-card mb-4">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="fas fa-images me-2"></i>Doküman Görselleri
            <span class="badge bg-info ms-2">
                {% if test_scenarios.image_count is defined %}{{ test_scenarios.image_count }}{% elif document_structure.image_count is defined %}{{ document_structure.image_count }}{% else %}0{% endif %} adet
            </span>
        </h5>
    </div>
    <div class="card-body">
        <div class="row">
            {% set images = test_scenarios.extracted_images if test_scenarios.extracted_images is defined else document_structure.extracted_images %}
            {% for image in images %}
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-img-container text-center p-2" style="height: 200px; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                        <img src="data:image/{{ image.format }};base64,{{ image.content }}" 
                             alt="{{ image.description or 'Doküman Görseli' }}"
                             class="img-fluid" style="max-height: 100%; object-fit: contain;">
                    </div>
                    <div class="card-body">
                        <h6 class="card-title">Görsel #{{ loop.index }}</h6>
                        <p class="card-text">
                            {% if image.description %}{{ image.description }}{% else %}Doküman Görseli {% endif %}
                        </p>
                        {% if image.analysis %}
                        <div class="mt-2">
                            <small class="text-muted">
                                <strong>AI Analizi:</strong><br>
                                {{ image.analysis }}
                            </small>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endif %}
